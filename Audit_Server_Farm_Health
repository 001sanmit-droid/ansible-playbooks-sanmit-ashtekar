# Title: System Health Audit for KVM VMs
# Author: Er. Sanmit Ashtekar | AWS --> EC2 S3 VPC IAM SG EKS| IAC-Terraform | CT-Ansible | VMware-ESXi 6.7+| DOCKER | K8S | Linux | Windows | python | shell | Flask | Sqlite | Bootstrap5 | Jinja2.0
# Description: This playbook audits uptime, CPU load, memory, and disk usage across all KVM-based virtual machines.

---
- name: Audit system health across KVM based VMs
  hosts: all
  become: true
  tasks:
    - name: Check system uptime
      command: uptime -p
      register: uptime_output
      changed_when: false

    - name: Display uptime
      debug:
        var: uptime_output.stdout

    - name: Check CPU load averages
      command: cat /proc/loadavg
      register: loadavg_output
      changed_when: false

    - name: Display CPU load
      debug:
        msg: "Load averages: {{ loadavg_output.stdout }}"

    - name: Check memory usage
      command: free -h
      register: memory_output
      changed_when: false

    - name: Display memory usage
      debug:
        var: memory_output.stdout_lines

    - name: Check disk usage
      command: df -h --exclude-type=tmpfs --exclude-type=devtmpfs
      register: disk_output
      changed_when: false

    - name: Display disk usage
      debug:
        var: disk_output.stdout_lines
